# 영속성 컨텍스트
* JPA를 이해하는데 가장 중요한 용어
* "엔티티를 영구 저장하는 환경" 이라는 뜻
* EntityManager.persistent(entity)

## 개념
* 영속성 컨텍스트는 논리적인 개념
* 눈에보이지 않는다
* 엔티티 매니저를 통해서 영속성 컨텍스트에 접근한다

## 엔티티의 생명주기

* 비영속(new / ransient)
  * 영속성 컨텍스트와 전혀 관계가 없는 새로운상태

* 영속(managed)
  * 영속성 컨텍스트에 관리되는 상태

* 준영속(detatched)
  * 영속성 컨텍스트에 저장되었다가 분리된상태
  
* 삭제(reㅊㅌㅇ ㄹㄹㄹㄹㄹㄹㄹㄹㄹmoved)
  * 삭제된 상태

### 영속성 컨텍스트의 이점
* 1차 캐시
* 동일성 보장
* 트랜잭션을 지원하는 쓰기지연
* 변경 감지
* 지연 로딩

### flush 발생
* commit 이 일어나면 변경감지
* 수정된 엔티티쓰기 지연 SQL 저장소에 등록된다
* 쓰기지연 SQL 저장소의쿼리를 데이터베이스에 전송한다
* 등록 수정 삭제 쿼리들이담겨있다
* flush가 발생한다고해서 commit 이 발생하는것이아니다
* commit이 발생해야 flush가 발생
* em.flush()-직접호출 코드 중간 commit 을 호출하지않고 변경사항이 진행되길 원할때 
* transaction - 자동호출
* flush를 하면 1차 캐시가 삭제되는것이아니고
* 쓰기지연 sql저장소에있는 변경감지 
* JPQL쿼리 실행 - 플러시 자동호출

* 모드옵션
* FlushModeType.AUTO (권장)
* FlushModeType.COMMIT
  * 커밋할때만 Flush
  
### 준영속 상태
* 영속 -> 준영속(디테치된상태) 
* 영속상태의 엔티티가 영속컨텍스트 의 상태에서 분리되는 경우
  * 업데이트 더티채킹을 사용하지못함
* .detach(객체); - 특정엔티티를 준영속상태로 전환
  * 영속성 컨텍스트에서 변경감지를 제외시킴
* .clear();
  * 영속성 컨텍스트내부를 초기화
*.close()
  * 영속성 컨텍스트를 종료



(복습)

### 영속성 컨텍스트의 이점
* 1차 캐시
* 동일성(identity)보장
* 트랜잭션을 지원하는 쓰기지연
* 변경감지
* 지연로딩

* 엔티티 매핑
  * 객체와 테이블 매핑 : @Entity, @Table
  * 필드와 컬럼 매핑 : @Column
  * 기본 키 매핑 : @Id
  * 연관관계 매핑 : @ManyToOne , @JoinColumn

  * 객체와 테이블 메핑
* Entity
  * @Entity가 붙은 클래스는 JPA가 관리 , 엔티티라 한다.
  * JPA를 사용해서 테이블과 매핑할 클래스는 @Entityvlftn
  * 주의
    * 기본 생성자 필수( parameter 가 없는 public 또는 protected생성자 )
    * fianl 클래스, enum, interface, inner 클래스 사용불가 
    * 저장할 필드에 final 사용할수 없음
    * 속성 : name
    * 